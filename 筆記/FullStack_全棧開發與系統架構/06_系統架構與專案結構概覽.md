# å°ˆæ¡ˆæ¶æ§‹èˆ‡é–‹ç™¼æµç¨‹

## ç¬¬ä¸€ç« ï¼šå…¨æ£§æ‡‰ç”¨æ¶æ§‹

### å…¸å‹çš„å…¨æ£§æ‡‰ç”¨çµæ§‹

```
å®¢æˆ¶ç«¯ï¼ˆFrontendï¼‰
    â”œâ”€ Vue 3 æ‡‰ç”¨
    â”œâ”€ UI çµ„ä»¶èˆ‡è¦–åœ–
    â””â”€ æ¥­å‹™é‚è¼¯
         â¬‡ï¸ HTTP è«‹æ±‚ï¼ˆAxiosï¼‰/å›æ‡‰
ä¼ºæœå™¨ï¼ˆBackendï¼‰
    â”œâ”€ Django REST Framework
    â”œâ”€ API ç«¯é»
    â””â”€ æ¥­å‹™é‚è¼¯
         â¬‡ï¸ è³‡æ–™åº«æ“ä½œ
è³‡æ–™åº«ï¼ˆDatabaseï¼‰
    â”œâ”€ SQLite / PostgreSQL
    â””â”€ è³‡æ–™è¡¨èˆ‡ç´¢å¼•
```

### å‰å¾Œç«¯åˆ†é›¢çš„å¥½è™•

| å„ªå‹¢ | èªªæ˜ |
|------|------|
| ç¨ç«‹é–‹ç™¼ | å‰å¾Œç«¯åœ˜éšŠä¸¦è¡Œå·¥ä½œ |
| æ˜“æ–¼æ¸¬è©¦ | API å¯å–®ç¨æ¸¬è©¦ |
| æŠ€è¡“éˆæ´» | å‰å¾Œç«¯æŠ€è¡“æ£§ç¨ç«‹ |
| å¯è¤‡ç”¨ | åŒä¸€ API æ”¯æ´å¤šå€‹å®¢æˆ¶ç«¯ |
| éƒ¨ç½²éˆæ´» | å‰å¾Œç«¯å¯åˆ†é–‹éƒ¨ç½² |

---

## ç¬¬äºŒç« ï¼šå°ˆæ¡ˆç›®éŒ„çµæ§‹è§£æ

### å¾Œç«¯çµæ§‹

```
backend/
â”œâ”€â”€ manage.py              # Django ç®¡ç†è…³æœ¬
â”œâ”€â”€ pyproject.toml         # ä¾è³´å®šç¾©
â”œâ”€â”€ config/                # å°ˆæ¡ˆé…ç½®
â”‚   â”œâ”€â”€ settings.py        # å…¨åŸŸè¨­å®š
â”‚   â”œâ”€â”€ urls.py            # ä¸»è·¯ç”±
â”‚   â”œâ”€â”€ wsgi.py            # WSGI æ‡‰ç”¨
â”‚   â””â”€â”€ asgi.py            # ASGI æ‡‰ç”¨ï¼ˆéåŒæ­¥ï¼‰
â”œâ”€â”€ api/                   # API æ‡‰ç”¨
â”‚   â”œâ”€â”€ models.py          # è³‡æ–™æ¨¡å‹
â”‚   â”œâ”€â”€ views.py           # è¦–åœ–é‚è¼¯
â”‚   â”œâ”€â”€ serializers.py     # åºåˆ—åŒ–å™¨
â”‚   â”œâ”€â”€ urls.py            # API è·¯ç”±
â”‚   â”œâ”€â”€ tests.py           # å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ migrations/        # è³‡æ–™åº«é·ç§»
â””â”€â”€ db.sqlite3             # SQLite è³‡æ–™åº«
```

**å„å€‹æª”æ¡ˆçš„è²¬ä»»ï¼š**
- `models.py`ï¼šå®šç¾©è³‡æ–™çµæ§‹ï¼ˆè³‡æ–™åº«è¡¨æ ¼ï¼‰
- `views.py`ï¼šè™•ç† HTTP è«‹æ±‚çš„æ¥­å‹™é‚è¼¯
- `serializers.py`ï¼šè³‡æ–™åºåˆ—åŒ–èˆ‡é©—è­‰
- `urls.py`ï¼šå®šç¾© API è·¯ç”±æ˜ å°„

### å‰ç«¯çµæ§‹

```
frontend/
â”œâ”€â”€ package.json           # ä¾è³´å®šç¾©
â”œâ”€â”€ vite.config.js         # Vite æ§‹å»ºé…ç½®
â”œâ”€â”€ index.html             # HTML å…¥å£
â”œâ”€â”€ public/                # éœæ…‹è³‡æº
â””â”€â”€ src/
    â”œâ”€â”€ main.js            # æ‡‰ç”¨å…¥å£
    â”œâ”€â”€ App.vue            # æ ¹çµ„ä»¶
    â”œâ”€â”€ style.css          # å…¨åŸŸæ¨£å¼
    â”œâ”€â”€ router/
    â”‚   â””â”€â”€ index.js       # è·¯ç”±é…ç½®
    â”œâ”€â”€ views/             # é é¢ç´šçµ„ä»¶
    â”‚   â”œâ”€â”€ HomeView.vue
    â”‚   â””â”€â”€ FavoritesView.vue
    â”œâ”€â”€ components/        # å¯è¤‡ç”¨çµ„ä»¶
    â”‚   â”œâ”€â”€ RandomDog.vue
    â”‚   â””â”€â”€ FavoriteList.vue
    â””â”€â”€ assets/            # è³‡æºæª”æ¡ˆ
```

**å‘½åç´„å®šï¼š**
- `views/` å°æ‡‰è·¯ç”±ï¼Œæ˜¯é é¢ç´šçµ„ä»¶
- `components/` æ˜¯å¯è¤‡ç”¨çš„ UI çµ„ä»¶
- æª”æ¡ˆåç”¨ PascalCase å¤§é§å³°å¼

---

## ç¬¬ä¸‰ç« ï¼šé–‹ç™¼å·¥ä½œæµç¨‹

### 1. æœ¬åœ°é–‹ç™¼ç’°å¢ƒå•Ÿå‹•

**å•Ÿå‹•å¾Œç«¯æœå‹™å™¨ï¼š**
```bash
cd backend
python manage.py runserver
# å•Ÿå‹•åœ¨ http://127.0.0.1:8000
```

**å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ï¼š**
```bash
cd frontend
npm run dev
# å•Ÿå‹•åœ¨ http://localhost:5173
```

### 2. é–‹ç™¼ä¸€å€‹æ–°åŠŸèƒ½çš„å®Œæ•´æµç¨‹

**æ­¥é©Ÿ 1ï¼šå®šç¾©è³‡æ–™æ¨¡å‹ï¼ˆå¾Œç«¯ï¼‰**
```python
# api/models.py
class DogImage(models.Model):
    url = models.URLField(max_length=500)
    created_at = models.DateTimeField(auto_now_add=True)
```

**æ­¥é©Ÿ 2ï¼šå‰µå»ºè³‡æ–™åº«é·ç§»**
```bash
python manage.py makemigrations
python manage.py migrate
```

**æ­¥é©Ÿ 3ï¼šå»ºç«‹åºåˆ—åŒ–å™¨ï¼ˆå¾Œç«¯ï¼‰**
```python
# api/serializers.py
class DogImageSerializer(serializers.ModelSerializer):
    class Meta:
        model = DogImage
        fields = '__all__'
```

**æ­¥é©Ÿ 4ï¼šå¯¦ç¾ API è¦–åœ–ï¼ˆå¾Œç«¯ï¼‰**
```python
# api/views.py
class DogImageViewSet(viewsets.ModelViewSet):
    queryset = DogImage.objects.all().order_by('-created_at')
    serializer_class = DogImageSerializer
```

**æ­¥é©Ÿ 5ï¼šè¨»å†Šè·¯ç”±ï¼ˆå¾Œç«¯ï¼‰**
```python
# api/urls.py
router = DefaultRouter()
router.register(r'dogs', DogImageViewSet)
```

**æ­¥é©Ÿ 6ï¼šå»ºç«‹å‰ç«¯çµ„ä»¶**
```vue
<!-- components/RandomDog.vue -->
<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const dogImage = ref('')

const fetchNewDog = async () => {
  const response = await axios.get('https://dog.ceo/api/breeds/image/random')
  dogImage.value = response.data.message
}

onMounted(() => {
  fetchNewDog()
})
</script>
```

**æ­¥é©Ÿ 7ï¼šé›†æˆ API èª¿ç”¨ï¼ˆå‰ç«¯ï¼‰**
```javascript
const saveDog = async () => {
  await axios.post('http://127.0.0.1:8000/api/dogs/', {
    url: dogImage.value
  })
  alert('æ”¶è—æˆåŠŸï¼')
}
```

**æ­¥é©Ÿ 8ï¼šåœ¨è·¯ç”±ä¸­ä½¿ç”¨çµ„ä»¶ï¼ˆå‰ç«¯ï¼‰**
```javascript
// router/index.js
import RandomDog from '../components/RandomDog.vue'
```

---

## ç¬¬å››ç« ï¼šè³‡æ–™æµå‘

### ç”¨æˆ¶æ”¶è—ç‹—ç‹—åœ–ç‰‡çš„æ•´å€‹æµç¨‹
```mermaid
flowchart LR
    %% === æ¨£å¼å®šç¾© ===
    %% åŸºç¤ç¯€é»é¢¨æ ¼ (é»‘ç™½é«˜å°æ¯”)
    classDef base fill:#fff,stroke:#333,stroke-width:2px,color:#000;
    classDef action fill:#f9f9f9,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5,color:#000;
    classDef db fill:#eee,stroke:#333,stroke-width:2px,stroke-width:2px,color:#000;
    
    %% Subgraph èƒŒæ™¯é¢¨æ ¼ (æ·¡ç°éšå€åˆ†å€åŸŸ)
    style Client fill:#ffffff,stroke:#333,stroke-width:2px,color:#000
    style Server fill:#f4f4f4,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5,color:#000
    style Database fill:#e0e0e0,stroke:#333,stroke-width:2px,color:#000

    %% === æµç¨‹å®šç¾© ===
    subgraph Client [å‰ç«¯ : RandomDog.vue]
        direction TB
        Click(("ğŸ‘† é»æ“ŠæŒ‰éˆ•<br>@click='saveDog'"))
        Success["âœ… æ”¶è—æˆåŠŸ<br>alert() / Update UI"]
    end

    subgraph Server [å¾Œç«¯è™•ç† API]
        direction TB
        Req>"POST /api/dogs/<br>{ 'url': '...' }" ]
        Logic["ViewSet.create()"]
        Check{"Serializer<br>è³‡æ–™é©—è­‰"}
        Res>"201 Created<br>{ id: 1, ... }" ]
    end

    subgraph Database [SQLite è³‡æ–™åº«]
        SQL[("ğŸ’¾ INSERT INTO<br>api_dogimage")]
    end

    %% === é€£ç·šé‚è¼¯ ===
    Click --> Req
    Req --> Logic
    Logic --> Check
    
    %% é©—è­‰æˆåŠŸè·¯å¾‘
    Check -->|Pass| SQL
    SQL -->|Saved| Res
    
    %% å›å‚³è·¯å¾‘
    Res --> Success

    %% === å¥—ç”¨æ¨£å¼ ===
    class Click,Logic,Check base;
    class Req,Res action;
    class SQL db;
    class Success base;
```

---

## ç¬¬äº”ç« ï¼šæ¸¬è©¦æœ€ä½³å¯¦è¸

### å¾Œç«¯ API æ¸¬è©¦

**ä½¿ç”¨ Postman æˆ– curl æ¸¬è©¦ï¼š**
```bash
# å–å¾—æ‰€æœ‰ç‹—ç‹—
curl http://127.0.0.1:8000/api/dogs/

# å»ºç«‹æ–°ç‹—ç‹—
curl -X POST http://127.0.0.1:8000/api/dogs/ \
  -H "Content-Type: application/json" \
  -d '{"url":"https://example.com/dog.jpg"}'

# åˆªé™¤ç‹—ç‹—
curl -X DELETE http://127.0.0.1:8000/api/dogs/1/
```

**Django å–®å…ƒæ¸¬è©¦ï¼š**
```python
# api/tests.py
from django.test import TestCase
from rest_framework.test import APIClient
from .models import DogImage

class DogImageTestCase(TestCase):
    def setUp(self):
        self.client = APIClient()
    
    def test_list_dogs(self):
        response = self.client.get('/api/dogs/')
        self.assertEqual(response.status_code, 200)
    
    def test_create_dog(self):
        response = self.client.post('/api/dogs/', {
            'url': 'https://example.com/dog.jpg'
        })
        self.assertEqual(response.status_code, 201)
```

**åŸ·è¡Œæ¸¬è©¦ï¼š**
```bash
python manage.py test
```

### å‰ç«¯çµ„ä»¶æ¸¬è©¦

```javascript
// components/__tests__/RandomDog.spec.js
import { describe, it, expect, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import RandomDog from '../RandomDog.vue'
import axios from 'axios'

vi.mock('axios')

describe('RandomDog Component', () => {
  it('é¡¯ç¤ºåŠ è¼‰ä¸­ç‹€æ…‹', async () => {
    const wrapper = mount(RandomDog)
    expect(wrapper.text()).toContain('è¼‰å…¥ä¸­...')
  })
  
  it('æ”¶è—æŒ‰éˆ•è§¸ç™¼ POST è«‹æ±‚', async () => {
    axios.post.mockResolvedValue({ data: { id: 1 } })
    const wrapper = mount(RandomDog)
    await wrapper.find('button.btn-save').trigger('click')
    expect(axios.post).toHaveBeenCalled()
  })
})
```

---

## ç¬¬å…­ç« ï¼šå¸¸è¦‹é–‹ç™¼å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### CORS éŒ¯èª¤

**ç—‡ç‹€ï¼š** å‰ç«¯è«‹æ±‚è¢«ç€è¦½å™¨é˜»æ­¢
```
Access to XMLHttpRequest at 'http://127.0.0.1:8000/api/dogs/' 
from origin 'http://localhost:5173' has been blocked by CORS policy
```

**è§£æ±ºï¼š**
```python
# settings.py
INSTALLED_APPS = ['corsheaders', ...]
MIDDLEWARE = ['corsheaders.middleware.CorsMiddleware', ...]
CORS_ALLOWED_ORIGINS = ['http://localhost:5173']
```

### 404 è³‡æºæœªæ‰¾åˆ°

**å¯èƒ½åŸå› ï¼š**
1. API URL æ‹¼å¯«éŒ¯èª¤
2. å¾Œç«¯ä¼ºæœå™¨æœªå•Ÿå‹•
3. URL è·¯ç”±æœªæ­£ç¢ºè¨»å†Š

**èª¿è©¦æ­¥é©Ÿï¼š**
```bash
# æª¢æŸ¥è·¯ç”±
python manage.py show_urls

# ç”¨ curl æ¸¬è©¦
curl http://127.0.0.1:8000/api/dogs/
```

### è³‡æ–™é©—è­‰å¤±æ•—ï¼ˆ400 Bad Requestï¼‰

**æª¢æŸ¥å›æ‡‰è©³æƒ…ï¼š**
```javascript
try {
  await axios.post('/dogs/', data)
} catch (error) {
  console.log('éŒ¯èª¤è©³æƒ…:', error.response.data)
  // é€šå¸¸æœƒè¿”å›æ¬„ä½çš„å…·é«”é©—è­‰éŒ¯èª¤
}
```

---

## ç¬¬ä¸ƒç« ï¼šéƒ¨ç½²æ¸…å–®

### ç”Ÿç”¢ç’°å¢ƒå‰çš„æª¢æŸ¥æ¸…å–®

```
å¾Œç«¯æº–å‚™ï¼š
â˜ é—œé–‰ DEBUG æ¨¡å¼ (settings.py: DEBUG = False)
â˜ è¨­å®š ALLOWED_HOSTS
â˜ è¨­å®šå¼·å¤§çš„ SECRET_KEY
â˜ é…ç½®è³‡æ–™åº«ï¼ˆä¸ç”¨ SQLiteï¼‰
â˜ è¨­å®šéœæ…‹æª”æ¡ˆæ”¶é›†
â˜ é…ç½®éƒµä»¶è¨­å®š
â˜ åŸ·è¡Œå–®å…ƒæ¸¬è©¦

å‰ç«¯æº–å‚™ï¼š
â˜ åŸ·è¡Œ npm run build
â˜ æ¸¬è©¦æ§‹å»ºç‰ˆæœ¬
â˜ æª¢æŸ¥ API åŸºç¤ URL é…ç½®
â˜ æª¢æŸ¥è³‡æºè¼‰å…¥è·¯å¾‘

CORS é…ç½®ï¼š
â˜ æ›´æ–° CORS_ALLOWED_ORIGINS ç‚ºç”Ÿç”¢åŸŸå
â˜ ç§»é™¤é–‹ç™¼ç’°å¢ƒçš„å¯¬é¬†è¨­å®š
```

---

## ç¸½çµ

å…¨æ£§é–‹ç™¼è¦é»ï¼š
âœ… ç†è§£å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹
âœ… æ¸…æ™°çš„ç›®éŒ„çµæ§‹å’Œè²¬ä»»åˆ†å·¥
âœ… å®Œæ•´çš„é–‹ç™¼å·¥ä½œæµç¨‹
âœ… è‰¯å¥½çš„è³‡æ–™æµå‘è¨­è¨ˆ
âœ… å……åˆ†çš„æ¸¬è©¦è¦†è“‹
âœ… æ­£ç¢ºè™•ç†å¸¸è¦‹å•é¡Œ
âœ… ç‚ºç”Ÿç”¢ç’°å¢ƒåšå¥½æº–å‚™
